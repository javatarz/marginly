{"id":"book-review-platform-0dx","title":"Fix sync-books.mjs comment syntax error","description":"JSDoc comment contained public/books/*/ where */ was interpreted as comment terminator, causing syntax error on Vercel deploy.","status":"closed","priority":0,"issue_type":"bug","owner":"karun@japhet.in","created_at":"2026-01-17T14:11:52.858615+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:11:59.556219+05:30","closed_at":"2026-01-17T14:11:59.556219+05:30","close_reason":"Changed JSDoc block comment to line comments to avoid */ pattern being interpreted as comment terminator"}
{"id":"book-review-platform-0e9","title":"Update README with current architecture","description":"README is outdated:\n- References 'role' column but we use global_admins table now\n- Says GitHub Actions but we use Vercel CI/CD\n- Admin dashboard marked TODO but is built\n- Missing manifest.json auto-sync docs\n- Missing reading sessions, threaded comments features","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T14:37:48.745939+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:39:11.707573+05:30","closed_at":"2026-01-17T14:39:11.707573+05:30","close_reason":"Closed"}
{"id":"book-review-platform-1d5","title":"Update deploy workflow to fetch books before build","description":"## Context\nPlatform should pull latest book content on every deploy.\n\n## Update Vercel build or GitHub workflow\n\nOption A: Update scripts/ci-build.sh\n```bash\n#!/bin/bash\n# Fetch latest book content\nnode scripts/fetch-books.mjs\n\n# Continue with existing build\nnpm run lint\nnpm run build\n```\n\nOption B: Add pre-build step in Vercel settings\n- Build command: `node scripts/fetch-books.mjs \u0026\u0026 npm run build`\n\n## Secrets needed\n- GITHUB_TOKEN with repo scope (for private book repos)\n\n## Considerations\n- Fetch runs on every deploy (fresh content)\n- If fetch fails for one book, continue with others\n- Log which books were fetched and versions","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:14:05.941355+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:24:52.439323+05:30","closed_at":"2026-01-17T15:24:52.439323+05:30","close_reason":"Closed","dependencies":[{"issue_id":"book-review-platform-1d5","depends_on_id":"book-review-platform-7a3","type":"blocks","created_at":"2026-01-17T15:14:19.883255+05:30","created_by":"Karun Japhet"}]}
{"id":"book-review-platform-1id","title":"Build book and chapter rendering","description":"Home page showing accessible books, book page with table of contents, chapter page rendering HTML content. Include reading progress indicators and comment counts.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T09:44:49.160004+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T09:49:33.383163+05:30","closed_at":"2026-01-17T09:49:33.383163+05:30","close_reason":"Book list, table of contents, and chapter reader pages implemented with progress tracking"}
{"id":"book-review-platform-1xf","title":"Add LICENSE file","description":"Choose and add appropriate open source license (MIT vs Apache 2.0)","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:59.167095+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:26:57.879742+05:30","closed_at":"2026-01-17T22:26:57.879742+05:30","close_reason":"Superseded by 5uw (Apache 2.0 + Commons Clause)"}
{"id":"book-review-platform-27l","title":"Update CLAUDE.md project references","description":"Update all references from book-review-platform to marginly","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:44.168209+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:26:58.562267+05:30","closed_at":"2026-01-17T22:26:58.562267+05:30","close_reason":"Merged into qvx (Update page titles and branding)"}
{"id":"book-review-platform-2e7","title":"Add GitHub issue templates","description":"Add GitHub issue and PR templates.\n\n## Acceptance Criteria\n- [ ] Create .github/ISSUE_TEMPLATE/bug_report.md\n- [ ] Create .github/ISSUE_TEMPLATE/feature_request.md\n- [ ] Create .github/PULL_REQUEST_TEMPLATE.md\n\n## Bug Report Template Should Include\n- Description of the bug\n- Steps to reproduce\n- Expected behavior\n- Actual behavior\n- Environment (browser, OS, etc.)\n- Screenshots if applicable\n\n## Feature Request Template Should Include\n- Problem statement / use case\n- Proposed solution\n- Alternatives considered\n\n## PR Template Should Include\n- Description of changes\n- Related issue number\n- Testing done\n- Checklist (tests pass, lint passes, etc.)\n\n## Files to Create\n- .github/ISSUE_TEMPLATE/bug_report.md\n- .github/ISSUE_TEMPLATE/feature_request.md\n- .github/PULL_REQUEST_TEMPLATE.md","status":"closed","priority":3,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:59.321078+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:01:15.835894+05:30","closed_at":"2026-01-17T23:01:15.835894+05:30","close_reason":"Closed"}
{"id":"book-review-platform-2qg","title":"Configure Vercel deployment and DNS","description":"Deploy to Vercel, configure environment variables. Set up review.karun.me DNS pointing to Vercel. Configure analytics.karun.me CNAME for Umami.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T09:44:52.940366+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T10:47:07.273277+05:30","closed_at":"2026-01-17T10:47:07.273277+05:30","close_reason":"Vercel deployment and DNS configured"}
{"id":"book-review-platform-2wg","title":"Expose manifest.json schema at known URL","description":"## Context\nbrp owns the manifest contract. Books need to validate against it.\n\n## Implementation\n1. Create `public/schemas/manifest.v2.schema.json` (JSON Schema draft-07)\n2. Schema validates:\n   - version (must be 2)\n   - chapters[] with slug, title, number, status\n   - supplementary[] with slug, title, type\n   - book metadata (title, author, description, etc.)\n   - chapter stats (wordCount, readingMinutes, pageCount)\n   - totals object\n\n3. Accessible at: https://review.karun.me/schemas/manifest.v2.schema.json\n\n## Future\n- Version the schema URL (v2, v3, etc.)\n- Add validation endpoint if needed","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:31:47.657574+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:38:37.723858+05:30","closed_at":"2026-01-17T15:38:37.723858+05:30","close_reason":"Closed"}
{"id":"book-review-platform-33s","title":"Add chapters table entries and HTML content","description":"## Context\nThe book and book_access entries exist in Supabase, but chapters are missing.\n\n## Tasks\n1. Add chapter entries to the `chapters` table for chapters 1 and 2\n2. Set up HTML content delivery (either static files in `public/books/` or fetched from ie-book repo)\n3. Test that chapters render correctly after login\n\n## Chapter data needed\n- Chapter 1: 'production-doesnt-run-on-vibes', 'Production Doesn't Run on Vibes'\n- Chapter 2: 'the-careful-trap', 'The Careful Trap'","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T10:46:17.029368+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T12:59:22.082954+05:30","closed_at":"2026-01-17T12:59:22.082954+05:30","close_reason":"Replaced by book-review-platform-v4g (book discovery) and book-review-platform-aze (chapter sync)"}
{"id":"book-review-platform-4an","title":"Create books.config.example.json","description":"Example config file showing the structure for users to copy.\n\n## Acceptance Criteria\n- [ ] Create books.config.example.json with placeholder values\n- [ ] Use 'your-username/your-book-repo' as example repo\n- [ ] Include comments or clear structure showing all supported options\n\n## Example Content\n```json\n{\n  \"books\": [\n    {\n      \"slug\": \"my-book\",\n      \"source\": {\n        \"type\": \"github-release\",\n        \"repo\": \"your-username/your-book-repo\",\n        \"release\": \"latest\"\n      }\n    }\n  ]\n}\n```\n\n## Files to Create\n- books.config.example.json","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:26.93523+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:35:07.362896+05:30","closed_at":"2026-01-17T22:35:07.362896+05:30","close_reason":"Closed"}
{"id":"book-review-platform-4rl","title":"Add global admin support","description":"Add global_admins table and update RLS policies to support platform-wide admin access. Global admins can access all books without needing per-book entries in book_access.","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T14:11:38.676278+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:11:45.345728+05:30","closed_at":"2026-01-17T14:11:45.345728+05:30","close_reason":"Added global_admins table, updated RLS policies for books/chapters/comments, fixed all pages to use RLS instead of querying book_access directly, added trigger for auto-linking user_id"}
{"id":"book-review-platform-570","title":"EPIC: Phase 3 - Add license and go public","description":"Add Apache 2.0 + Commons Clause license and finalize for public release.\n\n## Purpose\nAllow full FOSS usage but restrict commercial use without permission.\n\n## Subtasks (in order)\n1. [5uw] Add LICENSE file with Apache 2.0 + Commons Clause\n2. [yt7] Update README.md license section\n3. [70r] Create comprehensive README.md\n4. [l5s] Create comprehensive CONTRIBUTING.md\n5. [2e7] Add GitHub issue templates\n6. [d1u] Make CLAUDE.md generic\n\n## Prerequisites\n- Phase 1 (clean personal data) complete\n- Phase 2 (rename to Marginly) complete\n- Git history purged\n\n## Notes\n- This is the final phase before making the repo public\n- Apache 2.0 provides the base permissive license\n- Commons Clause adds commercial use restriction","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:24:04.272507+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:01:15.890013+05:30","closed_at":"2026-01-17T23:01:15.890013+05:30","close_reason":"Closed"}
{"id":"book-review-platform-5kc","title":"Schema page redirects to login","description":"public/schemas/*.json should be publicly accessible without auth. Middleware needs to exclude /schemas/* routes.","status":"closed","priority":0,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T17:36:49.010705+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T17:37:28.81186+05:30","closed_at":"2026-01-17T17:37:28.81186+05:30","close_reason":"Closed"}
{"id":"book-review-platform-5uw","title":"Add LICENSE file with Apache 2.0 + Commons Clause","description":"Create LICENSE file with Apache 2.0 base + Commons Clause addon.\n\n## Acceptance Criteria\n- [ ] Create LICENSE file with Apache 2.0 text\n- [ ] Add Commons Clause at the top\n- [ ] Verify formatting is correct\n\n## Commons Clause Text (prepend to Apache 2.0)\n```\nCommons Clause License Condition v1.0\n\nThe Software is provided to you by the Licensor under the License, as defined below, subject to the following condition.\n\nWithout limiting other conditions in the License, the grant of rights under the License will not include, and the License does not grant to you, the right to Sell the Software.\n\nFor purposes of the foregoing, 'Sell' means practicing any or all of the rights granted to you under the License to provide to third parties, for a fee or other consideration (including without limitation fees for hosting or consulting/support services related to the Software), a product or service whose value derives, entirely or substantially, from the functionality of the Software.\n\nAny license notice or attribution required by the License must also include this Commons Clause License Condition notice.\n\nSoftware: Marginly\nLicense: Apache 2.0\nLicensor: Karun Japhet\n\n---\n```\n\nThen followed by standard Apache 2.0 license text.\n\n## Files to Create\n- LICENSE\n\n## Depends On\n- Phase 1 complete\n- Phase 2 complete","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:24:16.282693+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:58:09.32922+05:30","closed_at":"2026-01-17T22:58:09.32922+05:30","close_reason":"Closed"}
{"id":"book-review-platform-64r","title":"Validate manifest against brp schema in CI","description":"## Context\nbrp owns the manifest contract. ie-book should validate before publishing.\n\n## Implementation\n1. In release workflow, after building manifest:\n   - Fetch schema from https://review.karun.me/schemas/manifest.v2.schema.json\n   - Validate manifest.json against it\n   - Fail build if invalid\n\n2. Use ajv-cli or similar:\n   ```bash\n   curl -o manifest.schema.json https://review.karun.me/schemas/manifest.v2.schema.json\n   npx ajv-cli validate -s manifest.schema.json -d output/html/manifest.json\n   ```\n\n## Dependencies\n- Requires brp to expose schema first","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:31:48.588821+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:32:01.993735+05:30","closed_at":"2026-01-17T15:32:01.993735+05:30","close_reason":"Created in wrong repo - should be in ie-book"}
{"id":"book-review-platform-68v","title":"Update package.json name to marginly","description":"Change name field in package.json.\n\n## Acceptance Criteria\n- [ ] Update package.json 'name' field from 'book-review-platform' to 'marginly'\n- [ ] Run npm install to regenerate package-lock.json\n- [ ] Verify no other references to old name in package files\n\n## Files to Modify\n- package.json (name field)\n- package-lock.json (auto-regenerated)","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:43.929939+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:52:15.731843+05:30","closed_at":"2026-01-17T22:52:15.731843+05:30","close_reason":"Closed"}
{"id":"book-review-platform-6pe","title":"Initialize Next.js project structure","description":"Set up Next.js 14 with TypeScript, Tailwind, App Router. Create folder structure for components, lib, and app routes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T09:44:46.266081+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T09:49:29.957308+05:30","closed_at":"2026-01-17T09:49:29.957308+05:30","close_reason":"Initial Next.js 14 project with TypeScript, Tailwind, App Router scaffolded"}
{"id":"book-review-platform-6xc","title":"Update beads issue prefix to marginly","description":"Change the beads issue prefix from 'book-review-platform' to 'marginly'.\n\n## Acceptance Criteria\n- [ ] Run: bd config set issue_prefix marginly\n- [ ] Verify new issues get 'marginly-xxx' prefix\n- [ ] Existing issues keep their 'book-review-platform-xxx' IDs (expected)\n\n## Notes\n- This only affects NEW issues created after the change\n- Existing issues retain their original IDs for consistency","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:27:09.95175+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:00:51.08856+05:30","closed_at":"2026-01-17T23:00:51.08856+05:30","close_reason":"Closed"}
{"id":"book-review-platform-70r","title":"Create comprehensive README.md","description":"Document what Marginly is, features, self-hosting setup instructions, and screenshots.\n\n## Acceptance Criteria\n- [ ] Clear project description (what Marginly does)\n- [ ] Feature list with brief explanations\n- [ ] Self-hosting setup guide (Supabase, Vercel/other)\n- [ ] Environment variable documentation\n- [ ] Screenshots of key UI (optional but nice)\n- [ ] Quick start guide for local development\n\n## Sections to Include\n1. Project overview / tagline\n2. Features (bullet points)\n3. Tech stack\n4. Quick start (local dev)\n5. Self-hosting guide\n6. Environment variables\n7. Development commands\n8. Project structure (brief)\n9. License (reference LICENSE file)\n\n## Files to Modify\n- README.md\n\n## Notes\n- Current README is mostly good, enhance rather than rewrite\n- Add screenshots if available\n- Make sure self-hosting instructions are complete","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:59.09059+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:58:57.829626+05:30","closed_at":"2026-01-17T22:58:57.829626+05:30","close_reason":"Closed"}
{"id":"book-review-platform-72a","title":"Selection expands to article start during drag","description":"When dragging to select text, the selection jumps to start from beginning of article. handleTextSelection is firing continuously during drag, re-capturing the selection. Should only fire on mouseup.","status":"closed","priority":0,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T20:36:33.60981+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T20:39:34.77698+05:30","closed_at":"2026-01-17T20:39:34.77698+05:30","close_reason":"Closed"}
{"id":"book-review-platform-7a3","title":"Create fetch-books.mjs to pull from GitHub releases","description":"## Context\nPlatform pulls book content from configured sources instead of books pushing to platform.\n\n## New script: scripts/fetch-books.mjs\n\n```javascript\n// For each book in books.config.json:\n// 1. Fetch latest release from GitHub API\n// 2. Download release artifact (tar.gz)\n// 3. Extract to public/books/{slug}/\n// 4. Verify manifest.json exists\n```\n\n## GitHub API for releases\n```\nGET /repos/{owner}/{repo}/releases/tags/{tag}\n```\n\nReturns asset download URLs. Need GITHUB_TOKEN for private repos.\n\n## Environment variables\n- GITHUB_TOKEN: Required for private repos (repo scope)\n\n## Error handling\n- Skip book if release not found (warn, don't fail)\n- Skip book if artifact missing\n- Validate manifest.json after extraction\n\n## CLI usage\n```bash\n# Fetch all books\nnode scripts/fetch-books.mjs\n\n# Fetch specific book\nnode scripts/fetch-books.mjs --book=intelligent-engineering\n```","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:14:05.067808+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:24:09.446783+05:30","closed_at":"2026-01-17T15:24:09.446783+05:30","close_reason":"Closed","dependencies":[{"issue_id":"book-review-platform-7a3","depends_on_id":"book-review-platform-lfk","type":"blocks","created_at":"2026-01-17T15:14:19.04513+05:30","created_by":"Karun Japhet"}]}
{"id":"book-review-platform-8ko","title":"Comment selection captures wrong text","description":"handleTextSelection uses window.getSelection() which captures any selected text on page, not just within chapter content div. Need to verify selection is within the target element.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T18:18:56.534755+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T18:20:13.178813+05:30","closed_at":"2026-01-17T18:20:13.178813+05:30","close_reason":"Closed"}
{"id":"book-review-platform-8xc","title":"EPIC: Phase 1 - Clean personal data from repo","description":"Remove all personal/specific data to prepare for public FOSS release.\n\n## Subtasks (in order)\n1. [b6v] Add public/books/ and books.config.json to .gitignore\n2. [4an] Create books.config.example.json\n3. [dzx] Create .env.example (rename from .env.local.example)\n4. [b1o] Update fetch-books.mjs to read config from env var\n5. [abs] Purge public/books/ and books.config.json from git history (LAST - destructive)\n\n## Notes\n- All subtasks must complete before history purge\n- History purge requires force-push","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:08.761452+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:51:45.278803+05:30","closed_at":"2026-01-17T22:51:45.278803+05:30","close_reason":"Closed"}
{"id":"book-review-platform-9sa","title":"Add unit test pipeline with Vitest","description":"Set up Vitest for unit testing components and utility functions. Add CI integration.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T11:05:31.077331+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:46:37.890256+05:30","closed_at":"2026-01-17T14:46:37.890256+05:30","close_reason":"Closed"}
{"id":"book-review-platform-9xm","title":"Rename GitHub repository to marginly","description":"Rename javatarz/book-review-platform to javatarz/marginly on GitHub.\n\n## Acceptance Criteria\n- [ ] Rename repository in GitHub Settings\n- [ ] Update local git remote URL\n- [ ] Verify push/pull works with new URL\n\n## Steps (manual)\n1. Go to GitHub repo Settings \u003e General\n2. Change repository name to 'marginly'\n3. Locally run: git remote set-url origin git@github.com:javatarz/marginly.git\n4. Verify: git remote -v\n\n## Prerequisites\n- All code changes (package.json, branding) must be pushed first\n- Do this LAST in Phase 2\n\n## Notes\n- GitHub will redirect old URLs for a period\n- All clone URLs will change","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:43.851068+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:54:42.21964+05:30","closed_at":"2026-01-17T22:54:42.21964+05:30","close_reason":"Closed"}
{"id":"book-review-platform-a0w","title":"Implement reading progress tracking","description":"Track scroll position and time spent per chapter. Record reading sessions. Mark chapters as completed when scroll reaches 90%.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T09:44:50.102991+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:21:34.610374+05:30","closed_at":"2026-01-17T14:21:34.610374+05:30","close_reason":"Added time tracking with idle detection, reading sessions, scroll restoration, and time_spent_seconds tracking"}
{"id":"book-review-platform-a2x","title":"Fix login flow - RLS blocks email check for unauthenticated users","description":"## Problem\nThe login page queries `book_access` to verify the email before sending a magic link. But the RLS policy requires authentication:\n\n```sql\nusing (user_id = auth.uid() or user_email = auth.email())\n```\n\nSince `auth.email()` is null for unauthenticated users, the query returns nothing and users see 'No account found' even when they have access.\n\n## Fix\nCreate a `security definer` function that anonymous users can call:\n\n```sql\ncreate or replace function public.check_email_has_access(check_email text)\nreturns boolean\nlanguage sql\nsecurity definer\nas $$\n  select exists (\n    select 1 from public.book_access\n    where user_email = lower(check_email)\n  );\n$$;\n\ngrant execute on function public.check_email_has_access(text) to anon;\n```\n\nThen update `src/app/login/page.tsx` to use `supabase.rpc('check_email_has_access', { check_email: email })` instead of querying the table directly.\n\n## Files to change\n- `supabase/migrations/\u003ctimestamp\u003e_add_check_access_function.sql` (new)\n- `src/app/login/page.tsx`","status":"closed","priority":0,"issue_type":"bug","owner":"karun@japhet.in","created_at":"2026-01-17T10:46:02.694992+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T11:05:48.640159+05:30","closed_at":"2026-01-17T11:05:48.640159+05:30","close_reason":"Added security definer function and updated login page to use RPC"}
{"id":"book-review-platform-abs","title":"Purge public/books/ from git history","description":"Use git filter-repo to remove all book content from history before going public.\n\n## Acceptance Criteria\n- [ ] Remove public/books/ from all git history\n- [ ] Remove books.config.json from all git history\n- [ ] Verify clean history with no personal book content\n- [ ] Force push to remote (requires explicit confirmation)\n\n## Prerequisites\n- [ ] All other Phase 1 tasks must be complete first\n- [ ] git-filter-repo must be installed (brew install git-filter-repo)\n\n## Commands (reference)\n```bash\ngit filter-repo --path public/books/ --path books.config.json --invert-paths\ngit push --force-with-lease\n```\n\n## WARNINGS\n- This rewrites git history and requires force push\n- All collaborators will need to re-clone\n- This is irreversible - backup first if needed\n\n## Depends On\n- b6v (gitignore)\n- 4an (example config)\n- dzx (env.example)\n- b1o (fetch-books env var support)","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:27.087332+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:51:45.220902+05:30","closed_at":"2026-01-17T22:51:45.220902+05:30","close_reason":"Closed"}
{"id":"book-review-platform-akm","title":"EPIC: Phase 3 - FOSS documentation","description":"Create documentation for open source release including README, LICENSE, and contribution guidelines","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:51.253735+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:26:58.222231+05:30","closed_at":"2026-01-17T22:26:58.222231+05:30","close_reason":"Superseded by 570 (Phase 3 - Add license and go public)"}
{"id":"book-review-platform-aze","title":"Sync manifest.json to chapters table on deploy","description":"## Context\nWhen book content is pushed to `public/books/{slug}/manifest.json`, sync chapter metadata to Supabase.\n\n## Requirements\n1. Trigger on changes to `public/books/**/manifest.json`\n2. Read manifest.json for each book\n3. Upsert to `chapters` table: book_id, slug, number, title, status\n4. Depends on book existing (run after book discovery)\n\n## Implementation\nGitHub Action in book-review-platform:\n```yaml\non:\n  push:\n    paths:\n      - 'public/books/**/manifest.json'\n```\n\nUse Supabase REST API with service_role key (secrets stay in this repo).","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T12:59:15.775419+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T13:21:26.733896+05:30","closed_at":"2026-01-17T13:21:26.733896+05:30","close_reason":"Sync manifest.json to chapters table via Vercel pipeline"}
{"id":"book-review-platform-b1o","title":"Update fetch-books.mjs to read config from env var","description":"Support BOOKS_CONFIG env var as JSON string, fallback to file. Allows deployment without committing config.\n\n## Acceptance Criteria\n- [ ] Check for BOOKS_CONFIG env var first (JSON string)\n- [ ] Fall back to books.config.json file if env var not set\n- [ ] Parse JSON from env var and validate structure\n- [ ] Log which config source is being used\n- [ ] Update User-Agent from 'book-review-platform' to 'marginly'\n\n## Implementation\n```javascript\nasync function loadConfig() {\n  // Check env var first\n  if (process.env.BOOKS_CONFIG) {\n    console.log('Loading config from BOOKS_CONFIG env var');\n    return JSON.parse(process.env.BOOKS_CONFIG);\n  }\n  // Fall back to file\n  console.log('Loading config from books.config.json');\n  const content = await readFile(CONFIG_PATH, 'utf-8');\n  return JSON.parse(content);\n}\n```\n\n## Files to Modify\n- scripts/fetch-books.mjs (loadConfig function, User-Agent strings)\n\n## Notes\n- User-Agent update is included here since we're already modifying this file","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:27.163328+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:49:50.433312+05:30","closed_at":"2026-01-17T22:49:50.433312+05:30","close_reason":"Closed"}
{"id":"book-review-platform-b51","title":"Comment selection disrupted by time tracking re-renders","description":"Text selection was being disrupted during drag because setTimeSpent() ran every 1s causing React re-renders that re-applied dangerouslySetInnerHTML. Fixed by changing timeSpent from state to ref.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T21:48:49.290613+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T21:48:54.943998+05:30","closed_at":"2026-01-17T21:48:54.943998+05:30","close_reason":"Closed"}
{"id":"book-review-platform-b6v","title":"Add public/books/ and books.config.json to .gitignore","description":"Prevent book content and personal config from being tracked.\n\n## Acceptance Criteria\n- [ ] Add `public/books/` to .gitignore\n- [ ] Add `books.config.json` to .gitignore\n- [ ] Verify existing tracked files show as 'deleted' in git status after gitignore update\n\n## Files to Modify\n- .gitignore\n\n## Notes\n- Must be done BEFORE history purge\n- After gitignore update, files will still be in git until explicitly removed","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:26.858297+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:34:52.272232+05:30","closed_at":"2026-01-17T22:34:52.272232+05:30","close_reason":"Closed"}
{"id":"book-review-platform-bun","title":"Fix email and signout button alignment in header","description":"In the header, the email address and 'Sign out' button are not vertically aligned.\n\nCause: The form element wrapping the signout button may cause baseline misalignment.\n\nLocation: src/app/page.tsx lines 40-49\n\nFix: Ensure consistent vertical alignment, possibly by styling the form/button to match text baseline.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:27:56.186233+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:31:05.019224+05:30","closed_at":"2026-01-17T15:31:05.019224+05:30","close_reason":"Closed"}
{"id":"book-review-platform-d1u","title":"Make CLAUDE.md generic","description":"Remove personal URL examples, make instructions generic for any deployer.\n\n## Acceptance Criteria\n- [ ] Replace analytics.karun.me with generic placeholder\n- [ ] Replace review.karun.me with generic placeholder\n- [ ] Remove any personal-specific instructions\n- [ ] Ensure self-hosters can follow instructions easily\n\n## Files to Modify\n- CLAUDE.md\n\n## Search for Personal References\n```bash\ngrep -n 'karun' CLAUDE.md\n```\n\n## Notes\n- Keep the structure and technical content\n- Just replace personal URLs/names with generic placeholders","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:27.240336+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:57:38.077857+05:30","closed_at":"2026-01-17T22:57:38.077857+05:30","close_reason":"Closed"}
{"id":"book-review-platform-dzx","title":"Create .env.example","description":"Document all required environment variables for self-hosting.\n\n## Acceptance Criteria\n- [ ] Rename .env.local.example to .env.example\n- [ ] Remove personal analytics URL (analytics.karun.me)\n- [ ] Include all environment variables grouped by purpose\n\n## Required Environment Variables\n### Core (required for local dev)\n- NEXT_PUBLIC_SUPABASE_URL\n- NEXT_PUBLIC_SUPABASE_ANON_KEY\n- NEXT_PUBLIC_APP_URL\n\n### Book Fetching (optional - for fetch-books script)\n- GITHUB_TOKEN (for private repos)\n- BOOKS_CONFIG (JSON string, alternative to books.config.json file)\n\n### CI/CD (required for Vercel deployment)\n- SUPABASE_ACCESS_TOKEN\n- SUPABASE_PROJECT_REF\n- SUPABASE_SERVICE_ROLE_KEY\n\n### Analytics (optional)\n- NEXT_PUBLIC_UMAMI_WEBSITE_ID\n- NEXT_PUBLIC_UMAMI_URL\n\n## Files to Modify\n- Delete: .env.local.example\n- Create: .env.example","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:27.012127+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:49:19.772684+05:30","closed_at":"2026-01-17T22:49:19.772684+05:30","close_reason":"Closed"}
{"id":"book-review-platform-ftp","title":"Build admin dashboard","description":"Dashboard for author to see all readers, their progress, and comments. Invite new readers. View comments with filters by chapter/reader. Basic analytics.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T09:44:51.993503+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:30:09.445129+05:30","closed_at":"2026-01-17T14:30:09.445129+05:30","close_reason":"Added admin dashboard with readers management, comments review with filters, and chapter-level analytics"}
{"id":"book-review-platform-inb","title":"EPIC: Phase 2 - Rename to Marginly","description":"Rename all references from book-review-platform to Marginly.\n\n## Subtasks (in order)\n1. [68v] Update package.json name to marginly\n2. [qvx] Update page titles, branding, and CLAUDE.md to Marginly\n3. [6xc] Update beads issue prefix to marginly\n4. [9xm] Rename GitHub repository to marginly (manual - do after code pushed)\n5. [zg3] Rename Vercel project to marginly (manual - do after GitHub rename)\n\n## Notes\n- Code changes first (68v, qvx, 6xc), then push\n- Then manual renames (9xm GitHub, zg3 Vercel)\n- After GitHub rename, update git remote URL\n- README license change happens in Phase 3 (separate card)","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:35.421278+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:52:53.078404+05:30","closed_at":"2026-01-17T22:52:53.078404+05:30","close_reason":"Closed"}
{"id":"book-review-platform-kwy","title":"DECISION: Choose open source license","description":"Options:\n\n**MIT License**\n- Pros: Maximum adoption, simple, widely understood\n- Cons: No copyleft, no patent protection\n\n**Apache 2.0**\n- Pros: Patent protection, corporate-friendly, still permissive\n- Cons: Slightly more complex text\n\n**AGPL-3.0**\n- Pros: Copyleft for SaaS - if someone hosts Marginly, they must share changes\n- Cons: Scares away corporate contributors\n\nRecommendation: MIT for maximum adoption, or Apache 2.0 if patent protection matters.","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:09:36.315635+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:26:57.535107+05:30","closed_at":"2026-01-17T22:26:57.535107+05:30","close_reason":"Decision made: Apache 2.0 + Commons Clause"}
{"id":"book-review-platform-l5s","title":"Create CONTRIBUTING.md","description":"Create comprehensive contributor guidelines.\n\n## Acceptance Criteria\nInclude all of the following sections:\n\n### Basic Sections\n- [ ] How to report bugs\n- [ ] How to suggest features\n- [ ] PR process (fork, branch, test, PR)\n- [ ] Code of conduct reference\n\n### Comprehensive Sections\n- [ ] Code style guide (ESLint/Prettier configuration)\n- [ ] Architecture overview\n- [ ] Testing requirements (unit tests, E2E tests)\n- [ ] Commit message format (reference CLAUDE.md format)\n- [ ] Review process and expectations\n\n## Files to Create\n- CONTRIBUTING.md\n\n## Notes\n- Reference existing CLAUDE.md for commit message format\n- Keep architecture section high-level, link to detailed docs if needed","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:59.243327+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:59:27.279788+05:30","closed_at":"2026-01-17T22:59:27.279788+05:30","close_reason":"Closed"}
{"id":"book-review-platform-lfk","title":"Add books.config.json for book sources","description":"## Context\nPlatform should discover books from a config file, not hardcode them.\n\n## New file: books.config.json\n```json\n{\n  \"books\": [\n    {\n      \"slug\": \"intelligent-engineering\",\n      \"source\": {\n        \"type\": \"github-release\",\n        \"repo\": \"javatarz/intelligent-engineering-book\",\n        \"release\": \"latest\"\n      }\n    }\n  ]\n}\n```\n\n## Future extensibility\nSource types could include:\n- github-release (current)\n- github-pages\n- url (direct HTTP fetch)\n\n## Usage\n- fetch-books.mjs reads this config\n- Platform deploy workflow iterates over configured books\n- Easy to add new books: add entry to config","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:14:04.222174+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:23:00.621682+05:30","closed_at":"2026-01-17T15:23:00.621682+05:30","close_reason":"Closed"}
{"id":"book-review-platform-myi","title":"Implement magic link auth flow","description":"Implement invite-only auth: login page checks book_access before sending magic link, auth callback, session middleware, signout. No self-registration allowed.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T09:44:48.200971+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T09:49:32.280951+05:30","closed_at":"2026-01-17T09:49:32.280951+05:30","close_reason":"Magic link auth with invite-only check, middleware, and session handling implemented"}
{"id":"book-review-platform-n14","title":"Remove versions table, use manifest lastUpdated","description":"## Context\nTrunk-based releases mean we don't need semantic versioning. Simplify by removing versions table and using manifest's lastUpdated field directly.\n\n## Changes\n\n### Database\n- Remove `versions` table\n- Add `last_synced_at` column to `books` table (when content was last fetched)\n- Keep `reading_progress.last_read_at` for \"new since you visited\" comparison\n\n### Logic for \"new content\" indicator\n```\nhasNewContent = book.last_synced_at \u003e user.reading_progress.last_read_at\n```\n\n### UI\n- Remove any version display\n- Show \"Updated\" badge if content changed since user's last visit\n- Show last updated date on book page (from manifest)\n\n### Migration\n- Create migration to drop versions table\n- Add last_synced_at to books table\n- Update sync-books.mjs to set last_synced_at when syncing\n\n## Files to update\n- supabase/migrations/ (new migration)\n- scripts/sync-books.mjs\n- Book page component (show last updated)\n- Chapter list (show \"new\" indicators)","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:16:13.847033+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:33:14.01918+05:30","closed_at":"2026-01-17T15:33:14.01918+05:30","close_reason":"Closed"}
{"id":"book-review-platform-nzq","title":"DECISION: CONTRIBUTING.md scope and content","description":"Options:\n\n**Minimal (recommended for start)**\n- How to report bugs\n- How to suggest features  \n- PR process (fork, branch, test, PR)\n- Code of conduct reference\n\n**Comprehensive**\n- All of minimal, plus:\n- Code style guide (Prettier/ESLint config explanation)\n- Architecture overview\n- Testing requirements\n- Commit message format\n- Review process details\n\n**With templates**\n- GitHub issue templates (bug, feature)\n- PR template with checklist\n\nRecommendation: Start minimal, add more as community grows. Templates are low effort and helpful.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:09:45.743853+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:28:20.82821+05:30","closed_at":"2026-01-17T22:28:20.82821+05:30","close_reason":"Decision made: Comprehensive CONTRIBUTING.md"}
{"id":"book-review-platform-o6n","title":"Support manifest v2 with supplementary resources","description":"## Context\nBooks declare their content through manifest.json. We need to support a v2 format that includes supplementary resources like bibliography and appendices.\n\n## Contract (manifest.json v2)\n\n```json\n{\n  \"version\": 2,\n  \"chapters\": [\n    {\"slug\": \"production-doesnt-run-on-vibes\", \"title\": \"...\", \"number\": 1, \"status\": \"ready\"}\n  ],\n  \"supplementary\": [\n    {\"slug\": \"bibliography\", \"title\": \"References\", \"type\": \"bibliography\"}\n  ]\n}\n```\n\n## Changes Required\n\n### 1. Update manifest reading logic\n\nIn scripts/sync-books.mjs (or wherever manifest is read):\n- Detect manifest version (v1 = array, v2 = object with version field)\n- Handle both formats for backwards compatibility\n- Extract chapters from `manifest.chapters` for v2\n\n### 2. Update [book]/[chapter] route (or rename to [book]/[content])\n\nCurrent: Only looks up chapters in database\nNew: Also check supplementary resources from manifest\n\nLogic:\n1. Fetch manifest for the book\n2. Check if slug exists in `chapters` array → serve as chapter\n3. Check if slug exists in `supplementary` array → serve as supplementary content\n4. Neither → 404\n\n### 3. Serve supplementary content\n\n- Same pattern as chapters: fetch HTML from `/books/{bookSlug}/{slug}.html`\n- Apply authentication (same as chapters)\n- Simpler UI than chapters (no chapter number, no prev/next navigation)\n- Include back link to book page\n\n### 4. Update book page to show supplementary links\n\nOn the book's table of contents page, show supplementary resources:\n- \"References\" link if bibliography exists\n- \"Appendix A: ...\" if appendices exist","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T14:52:31.976555+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:56:41.705658+05:30","closed_at":"2026-01-17T14:56:41.705658+05:30","close_reason":"Closed"}
{"id":"book-review-platform-pm4","title":"Book content discovery and sync from GitHub releases","description":"## Overview\nDecouple book-review-platform from individual book repos. Platform discovers and pulls book content from GitHub releases instead of books pushing directly.\n\n## Goals\n- Clean separation: books publish releases, platform pulls them\n- Easy to add new books via config\n- Manifest-based contract (v2 format with chapters, supplementary, metadata)\n- Track content updates without semantic versioning\n\n## Tasks\n- book-review-platform-o6n: Support manifest v2 with supplementary\n- book-review-platform-lfk: Add books.config.json\n- book-review-platform-7a3: Create fetch-books.mjs\n- book-review-platform-1d5: Update deploy workflow\n- book-review-platform-n14: Remove versions table, use lastUpdated","status":"closed","priority":1,"issue_type":"epic","owner":"karun@japhet.in","created_at":"2026-01-17T15:17:29.393736+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:38:37.782774+05:30","closed_at":"2026-01-17T15:38:37.782774+05:30","close_reason":"Closed","dependencies":[{"issue_id":"book-review-platform-pm4","depends_on_id":"book-review-platform-o6n","type":"blocks","created_at":"2026-01-17T15:17:36.026849+05:30","created_by":"Karun Japhet"},{"issue_id":"book-review-platform-pm4","depends_on_id":"book-review-platform-lfk","type":"blocks","created_at":"2026-01-17T15:17:36.107047+05:30","created_by":"Karun Japhet"},{"issue_id":"book-review-platform-pm4","depends_on_id":"book-review-platform-7a3","type":"blocks","created_at":"2026-01-17T15:17:36.190875+05:30","created_by":"Karun Japhet"},{"issue_id":"book-review-platform-pm4","depends_on_id":"book-review-platform-1d5","type":"blocks","created_at":"2026-01-17T15:17:36.272406+05:30","created_by":"Karun Japhet"},{"issue_id":"book-review-platform-pm4","depends_on_id":"book-review-platform-n14","type":"blocks","created_at":"2026-01-17T15:17:36.348555+05:30","created_by":"Karun Japhet"},{"issue_id":"book-review-platform-pm4","depends_on_id":"book-review-platform-aze","type":"blocks","created_at":"2026-01-17T15:18:13.629998+05:30","created_by":"Karun Japhet"},{"issue_id":"book-review-platform-pm4","depends_on_id":"book-review-platform-v4g","type":"blocks","created_at":"2026-01-17T15:18:13.68513+05:30","created_by":"Karun Japhet"},{"issue_id":"book-review-platform-pm4","depends_on_id":"book-review-platform-2wg","type":"blocks","created_at":"2026-01-17T15:32:10.409291+05:30","created_by":"Karun Japhet"}]}
{"id":"book-review-platform-pw7","title":"Add user profile with display name","description":"Allow users to click email in header to edit profile and set display name. Show display name in header and comments when set, fallback to email.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T17:35:44.149104+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T17:39:27.90688+05:30","closed_at":"2026-01-17T17:39:27.90688+05:30","close_reason":"Closed"}
{"id":"book-review-platform-qij","title":"Create Supabase schema and RLS policies","description":"Create database tables: books, chapters, book_access, comments, reading_progress, reading_sessions. Set up Row Level Security policies for invite-only access.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T09:44:47.221301+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T09:49:31.16657+05:30","closed_at":"2026-01-17T09:49:31.16657+05:30","close_reason":"Schema created in supabase/schema.sql with all tables and RLS policies"}
{"id":"book-review-platform-qvx","title":"Update page titles and branding to Marginly","description":"Update HTML titles, headers, and any UI text that says 'Book Review Platform'.\n\n## Acceptance Criteria\n- [ ] Update src/app/layout.tsx title to 'Marginly'\n- [ ] Update src/app/layout.tsx description\n- [ ] Update CLAUDE.md project references\n- [ ] Update README.md header from 'Book Review Platform' to 'Marginly'\n- [ ] Verify no remaining references to 'Book Review Platform' in codebase\n\n## Files to Modify\n- src/app/layout.tsx (title, description)\n- CLAUDE.md (project name references)\n- README.md (header only - NOT the license section)\n\n## Grep Check After\n```bash\ngrep -r 'Book Review Platform' --include='*.{ts,tsx,js,md,json}'\ngrep -r 'book-review-platform' --include='*.{ts,tsx,js,md,json}'\n```\n\n## Notes\n- README license change ('Private') stays until Phase 3\n- CLAUDE.md should use 'Marginly' for project name","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:44.006877+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:52:53.023384+05:30","closed_at":"2026-01-17T22:52:53.023384+05:30","close_reason":"Closed"}
{"id":"book-review-platform-rut","title":"Build inline commenting system","description":"Text selection to create comments anchored to specific paragraphs. Comment sidebar showing all comments for a chapter. Reply threads and resolve functionality.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T09:44:51.041615+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:26:26.652526+05:30","closed_at":"2026-01-17T14:26:26.652526+05:30","close_reason":"Added reply threads, resolve functionality, show/hide resolved filter"}
{"id":"book-review-platform-srf","title":"Add E2E test pipeline with Playwright","description":"Add E2E tests for critical paths: login flow, book access, chapter reading. Set up Playwright and CI integration.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T11:05:30.577372+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:46:37.966266+05:30","closed_at":"2026-01-17T14:46:37.966266+05:30","close_reason":"Closed"}
{"id":"book-review-platform-v4g","title":"Auto-discover books from public/books/ on deploy","description":"## Context\nBooks shouldn't need to be created manually in Supabase. The platform should discover them from the filesystem.\n\n## Requirements\n1. On deploy, scan `public/books/*/` directories\n2. Each directory with a `manifest.json` is a book\n3. Upsert to `books` table: slug (from directory name), title/description (from manifest or defaults)\n4. Run before chapter sync\n\n## Implementation options\n- GitHub Action triggered on `public/books/**/manifest.json` changes\n- Vercel build script\n- Script in package.json postbuild\n\n## Manifest additions needed\nAdd to manifest.json in ie-book:\n```json\n{\n  \"book\": {\n    \"title\": \"intelligent Engineering\",\n    \"description\": \"...\",\n    \"version\": \"0.02\"\n  },\n  \"chapters\": [...]\n}\n```","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T12:59:07.03139+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T13:21:26.678938+05:30","closed_at":"2026-01-17T13:21:26.678938+05:30","close_reason":"Auto-discover books from public/books/ via sync script"}
{"id":"book-review-platform-vw4","title":"Book card layout broken - date badge awkward position","description":"On homepage, the date badge next to title looked broken/awkward. Fixed by moving Updated badge to top-right corner and date to footer row with other metadata.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T21:49:02.714689+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T21:50:06.296349+05:30","closed_at":"2026-01-17T21:50:06.296349+05:30","close_reason":"Closed"}
{"id":"book-review-platform-vyk","title":"Consolidate CI/CD into single pipeline","description":"Merge migration and deploy into one coordinated pipeline. Add --include-all flag. Vercel should only deploy after migrations succeed.","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T11:16:14.538868+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T12:10:58.636324+05:30","closed_at":"2026-01-17T12:10:58.636324+05:30","close_reason":"Unified CI pipeline with lint, build, migrate stages"}
{"id":"book-review-platform-wpi","title":"Build admin dashboard","description":"## Features needed\n- View all readers and their access levels\n- See reading progress per reader per chapter\n- View and manage comments\n- Invite new readers (add to book_access)\n- Basic analytics (who read what, when)\n\n## Route\n`/admin` or `/[book]/admin`","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T10:46:17.570792+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T10:47:07.350058+05:30","closed_at":"2026-01-17T10:47:07.350058+05:30","close_reason":"Duplicate of book-review-platform-ftp"}
{"id":"book-review-platform-wuc","title":"Build book review platform MVP","description":"Build the core book review platform with auth, chapter rendering, inline comments, and reading progress tracking. Tech stack: Next.js 14, Supabase, Vercel.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-17T09:44:28.876099+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:41:04.610491+05:30","closed_at":"2026-01-17T14:41:04.610491+05:30","close_reason":"Closed"}
{"id":"book-review-platform-yje","title":"Add admin link to header for global admins","description":"Currently no UI path to /admin pages. Add an 'Admin' link in the header that only shows for users in the global_admins table.\n\nLocation: src/app/page.tsx (and possibly other pages with headers)\n\nRequirements:\n- Check if user is global admin\n- Show 'Admin' link next to email/signout\n- Link to /admin","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:27:48.487601+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:31:04.946027+05:30","closed_at":"2026-01-17T15:31:04.946027+05:30","close_reason":"Closed"}
{"id":"book-review-platform-yt7","title":"Update README.md license section for public release","description":"Change README from 'Private' to reference the Apache 2.0 + Commons Clause license.\n\n## Acceptance Criteria\n- [ ] Remove 'Private - for personal use only' text\n- [ ] Add proper license section referencing LICENSE file\n- [ ] Explain that commercial use requires permission\n\n## New License Section\n```markdown\n## License\n\nLicensed under Apache 2.0 with Commons Clause. See [LICENSE](LICENSE) for details.\n\nThis means you can freely use, modify, and distribute this software for non-commercial purposes. Commercial use requires explicit permission from the author.\n```\n\n## Files to Modify\n- README.md (License section at bottom)\n\n## Depends On\n- LICENSE file must be created first","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:24:16.620542+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:58:23.747296+05:30","closed_at":"2026-01-17T22:58:23.747296+05:30","close_reason":"Closed"}
{"id":"book-review-platform-zg3","title":"Rename Vercel project to marginly","description":"Update Vercel project name and configure marginly.karun.me domain.\n\n## Acceptance Criteria\n- [ ] Rename Vercel project from 'book-review-platform' to 'marginly'\n- [ ] Update custom domain if applicable (marginly.karun.me)\n- [ ] Verify deployment still works after rename\n\n## Steps (manual in Vercel dashboard)\n1. Go to Vercel project settings\n2. Change project name to 'marginly'\n3. Update domain configuration if needed\n4. Trigger a redeploy to verify\n\n## Notes\n- Do this after code changes are pushed\n- Existing deployments continue to work","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:44.086376+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:17:17.284478+05:30","closed_at":"2026-01-17T23:17:17.284478+05:30","close_reason":"Closed"}
{"id":"marginly-0au","title":"Allow admins to set user display names","description":"Admins should be able to set display names for users when inviting them or afterwards from the admin panel. This helps identify readers before they set their own profile.","status":"open","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-20T22:21:21.433539+05:30","created_by":"Karun Japhet","updated_at":"2026-01-20T22:21:21.433539+05:30"}
{"id":"marginly-0dx","title":"Fix sync-books.mjs comment syntax error","description":"JSDoc comment contained public/books/*/ where */ was interpreted as comment terminator, causing syntax error on Vercel deploy.","status":"closed","priority":0,"issue_type":"bug","owner":"karun@japhet.in","created_at":"2026-01-17T14:11:52.858615+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:11:59.556219+05:30","closed_at":"2026-01-17T14:11:59.556219+05:30","close_reason":"Changed JSDoc block comment to line comments to avoid */ pattern being interpreted as comment terminator"}
{"id":"marginly-0e9","title":"Update README with current architecture","description":"README is outdated:\n- References 'role' column but we use global_admins table now\n- Says GitHub Actions but we use Vercel CI/CD\n- Admin dashboard marked TODO but is built\n- Missing manifest.json auto-sync docs\n- Missing reading sessions, threaded comments features","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T14:37:48.745939+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:39:11.707573+05:30","closed_at":"2026-01-17T14:39:11.707573+05:30","close_reason":"Closed"}
{"id":"marginly-1d5","title":"Update deploy workflow to fetch books before build","description":"## Context\nPlatform should pull latest book content on every deploy.\n\n## Update Vercel build or GitHub workflow\n\nOption A: Update scripts/ci-build.sh\n```bash\n#!/bin/bash\n# Fetch latest book content\nnode scripts/fetch-books.mjs\n\n# Continue with existing build\nnpm run lint\nnpm run build\n```\n\nOption B: Add pre-build step in Vercel settings\n- Build command: `node scripts/fetch-books.mjs \u0026\u0026 npm run build`\n\n## Secrets needed\n- GITHUB_TOKEN with repo scope (for private book repos)\n\n## Considerations\n- Fetch runs on every deploy (fresh content)\n- If fetch fails for one book, continue with others\n- Log which books were fetched and versions","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:14:05.941355+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:24:52.439323+05:30","closed_at":"2026-01-17T15:24:52.439323+05:30","close_reason":"Closed","dependencies":[{"issue_id":"marginly-1d5","depends_on_id":"marginly-7a3","type":"blocks","created_at":"2026-01-17T15:14:19.883255+05:30","created_by":"Karun Japhet"}]}
{"id":"marginly-1dw","title":"Logout returns 405 error on /login page","description":"When clicking logout, user is redirected to https://marginly.karun.me/login but receives a 405 Method Not Allowed error. The logout flow should redirect to the login page successfully.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-20T21:08:18.203163+05:30","created_by":"Karun Japhet","updated_at":"2026-01-20T21:12:37.889138+05:30","closed_at":"2026-01-20T21:12:37.889138+05:30","close_reason":"Closed"}
{"id":"marginly-1id","title":"Build book and chapter rendering","description":"Home page showing accessible books, book page with table of contents, chapter page rendering HTML content. Include reading progress indicators and comment counts.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T09:44:49.160004+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T09:49:33.383163+05:30","closed_at":"2026-01-17T09:49:33.383163+05:30","close_reason":"Book list, table of contents, and chapter reader pages implemented with progress tracking"}
{"id":"marginly-1xf","title":"Add LICENSE file","description":"Choose and add appropriate open source license (MIT vs Apache 2.0)","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:59.167095+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:26:57.879742+05:30","closed_at":"2026-01-17T22:26:57.879742+05:30","close_reason":"Superseded by 5uw (Apache 2.0 + Commons Clause)"}
{"id":"marginly-27l","title":"Update CLAUDE.md project references","description":"Update all references from book-review-platform to marginly","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:44.168209+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:26:58.562267+05:30","closed_at":"2026-01-17T22:26:58.562267+05:30","close_reason":"Merged into qvx (Update page titles and branding)"}
{"id":"marginly-2e7","title":"Add GitHub issue templates","description":"Add GitHub issue and PR templates.\n\n## Acceptance Criteria\n- [ ] Create .github/ISSUE_TEMPLATE/bug_report.md\n- [ ] Create .github/ISSUE_TEMPLATE/feature_request.md\n- [ ] Create .github/PULL_REQUEST_TEMPLATE.md\n\n## Bug Report Template Should Include\n- Description of the bug\n- Steps to reproduce\n- Expected behavior\n- Actual behavior\n- Environment (browser, OS, etc.)\n- Screenshots if applicable\n\n## Feature Request Template Should Include\n- Problem statement / use case\n- Proposed solution\n- Alternatives considered\n\n## PR Template Should Include\n- Description of changes\n- Related issue number\n- Testing done\n- Checklist (tests pass, lint passes, etc.)\n\n## Files to Create\n- .github/ISSUE_TEMPLATE/bug_report.md\n- .github/ISSUE_TEMPLATE/feature_request.md\n- .github/PULL_REQUEST_TEMPLATE.md","status":"closed","priority":3,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:59.321078+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:01:15.835894+05:30","closed_at":"2026-01-17T23:01:15.835894+05:30","close_reason":"Closed"}
{"id":"marginly-2qg","title":"Configure Vercel deployment and DNS","description":"Deploy to Vercel, configure environment variables. Set up review.karun.me DNS pointing to Vercel. Configure analytics.karun.me CNAME for Umami.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T09:44:52.940366+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T10:47:07.273277+05:30","closed_at":"2026-01-17T10:47:07.273277+05:30","close_reason":"Vercel deployment and DNS configured"}
{"id":"marginly-2wg","title":"Expose manifest.json schema at known URL","description":"## Context\nbrp owns the manifest contract. Books need to validate against it.\n\n## Implementation\n1. Create `public/schemas/manifest.v2.schema.json` (JSON Schema draft-07)\n2. Schema validates:\n   - version (must be 2)\n   - chapters[] with slug, title, number, status\n   - supplementary[] with slug, title, type\n   - book metadata (title, author, description, etc.)\n   - chapter stats (wordCount, readingMinutes, pageCount)\n   - totals object\n\n3. Accessible at: https://review.karun.me/schemas/manifest.v2.schema.json\n\n## Future\n- Version the schema URL (v2, v3, etc.)\n- Add validation endpoint if needed","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:31:47.657574+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:38:37.723858+05:30","closed_at":"2026-01-17T15:38:37.723858+05:30","close_reason":"Closed"}
{"id":"marginly-33s","title":"Add chapters table entries and HTML content","description":"## Context\nThe book and book_access entries exist in Supabase, but chapters are missing.\n\n## Tasks\n1. Add chapter entries to the `chapters` table for chapters 1 and 2\n2. Set up HTML content delivery (either static files in `public/books/` or fetched from ie-book repo)\n3. Test that chapters render correctly after login\n\n## Chapter data needed\n- Chapter 1: 'production-doesnt-run-on-vibes', 'Production Doesn't Run on Vibes'\n- Chapter 2: 'the-careful-trap', 'The Careful Trap'","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T10:46:17.029368+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T12:59:22.082954+05:30","closed_at":"2026-01-17T12:59:22.082954+05:30","close_reason":"Replaced by book-review-platform-v4g (book discovery) and book-review-platform-aze (chapter sync)"}
{"id":"marginly-3aq","title":"Add collapsible comments sidebar","description":"Comments sidebar should be collapsible/minimizable for a cleaner reading experience, especially on mobile devices. Add toggle to show/hide comments.","status":"open","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-20T22:20:21.409957+05:30","created_by":"Karun Japhet","updated_at":"2026-01-20T22:20:21.409957+05:30"}
{"id":"marginly-429","title":"Create docs site with author integration guide","description":"Set up a GitHub Pages docs site using MkDocs + Material theme, and write an author integration guide.\n\n## Docs Site Setup\n- MkDocs with Material theme\n- GitHub Actions for auto-deploy on push to main\n- Site at javatarz.github.io/marginly (or configure custom domain later)\n- Docs source in docs/ folder as markdown\n\n## Author Guide Content\n\n**Target audience**: Authors who want to host their book on Marginly (self-serve from GitHub repo)\n\n**Sections**:\n1. **Overview** - What Marginly provides (reader management, comments, analytics, progress tracking)\n2. **Book Repository Setup** - Directory structure, HTML chapter files, manifest.json format\n3. **Manifest Reference** - All fields (title, description, version, chapters, supplementary), chapter statuses\n4. **Build Pipeline Basics** - Point to asciidoc/markdown tooling (links to docs and example tools, not full tutorial)\n5. **GitHub Releases** - How to create releases, tarball structure, versioning\n6. **Marginly Configuration** - How to configure BOOKS_CONFIG to add a book\n7. **Reader Management** - How invitations work, access control\n8. **Maintenance** - Updating chapters, changing slugs (and using migration), publishing workflow\n\n## Assumptions\n- Authors have their own build pipeline for HTML generation\n- Self-serve: users find repo, read docs, provision their own Marginly instance","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-19T20:28:38.331781+05:30","created_by":"Karun Japhet","updated_at":"2026-01-19T20:40:03.475315+05:30","closed_at":"2026-01-19T20:40:03.475315+05:30","close_reason":"Closed"}
{"id":"marginly-4an","title":"Create books.config.example.json","description":"Example config file showing the structure for users to copy.\n\n## Acceptance Criteria\n- [ ] Create books.config.example.json with placeholder values\n- [ ] Use 'your-username/your-book-repo' as example repo\n- [ ] Include comments or clear structure showing all supported options\n\n## Example Content\n```json\n{\n  \"books\": [\n    {\n      \"slug\": \"my-book\",\n      \"source\": {\n        \"type\": \"github-release\",\n        \"repo\": \"your-username/your-book-repo\",\n        \"release\": \"latest\"\n      }\n    }\n  ]\n}\n```\n\n## Files to Create\n- books.config.example.json","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:26.93523+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:35:07.362896+05:30","closed_at":"2026-01-17T22:35:07.362896+05:30","close_reason":"Closed"}
{"id":"marginly-4rl","title":"Add global admin support","description":"Add global_admins table and update RLS policies to support platform-wide admin access. Global admins can access all books without needing per-book entries in book_access.","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T14:11:38.676278+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:11:45.345728+05:30","closed_at":"2026-01-17T14:11:45.345728+05:30","close_reason":"Added global_admins table, updated RLS policies for books/chapters/comments, fixed all pages to use RLS instead of querying book_access directly, added trigger for auto-linking user_id"}
{"id":"marginly-570","title":"EPIC: Phase 3 - Add license and go public","description":"Add Apache 2.0 + Commons Clause license and finalize for public release.\n\n## Purpose\nAllow full FOSS usage but restrict commercial use without permission.\n\n## Subtasks (in order)\n1. [5uw] Add LICENSE file with Apache 2.0 + Commons Clause\n2. [yt7] Update README.md license section\n3. [70r] Create comprehensive README.md\n4. [l5s] Create comprehensive CONTRIBUTING.md\n5. [2e7] Add GitHub issue templates\n6. [d1u] Make CLAUDE.md generic\n\n## Prerequisites\n- Phase 1 (clean personal data) complete\n- Phase 2 (rename to Marginly) complete\n- Git history purged\n\n## Notes\n- This is the final phase before making the repo public\n- Apache 2.0 provides the base permissive license\n- Commons Clause adds commercial use restriction","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:24:04.272507+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:01:15.890013+05:30","closed_at":"2026-01-17T23:01:15.890013+05:30","close_reason":"Closed"}
{"id":"marginly-5ad","title":"Create demo GIF for README","description":"Record a GIF showing the core interaction flow.\n\n## Scenes to Capture\n1. Open a chapter\n2. Select/highlight text\n3. Add inline comment\n4. Show threaded reply\n5. Resolve the comment\n\n## Tools\n- Use a screen recorder (Kap, LICEcap, or similar)\n- Keep it short (15-30 seconds)\n- Optimize file size (\u003c5MB ideally)\n\n## Placement\nAdd to README after the description, before Features section\n\n## Acceptance Criteria\n- [ ] GIF shows full comment flow\n- [ ] File size reasonable (\u003c5MB)\n- [ ] Added to README\n- [ ] Alt text for accessibility\n\n## Notes\nLower priority - do after topics and badges","status":"closed","priority":3,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T23:51:16.438642+05:30","created_by":"Karun Japhet","updated_at":"2026-01-18T14:57:14.13491+05:30","closed_at":"2026-01-18T14:57:14.13491+05:30","close_reason":"Closed"}
{"id":"marginly-5kc","title":"Schema page redirects to login","description":"public/schemas/*.json should be publicly accessible without auth. Middleware needs to exclude /schemas/* routes.","status":"closed","priority":0,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T17:36:49.010705+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T17:37:28.81186+05:30","closed_at":"2026-01-17T17:37:28.81186+05:30","close_reason":"Closed"}
{"id":"marginly-5uw","title":"Add LICENSE file with Apache 2.0 + Commons Clause","description":"Create LICENSE file with Apache 2.0 base + Commons Clause addon.\n\n## Acceptance Criteria\n- [ ] Create LICENSE file with Apache 2.0 text\n- [ ] Add Commons Clause at the top\n- [ ] Verify formatting is correct\n\n## Commons Clause Text (prepend to Apache 2.0)\n```\nCommons Clause License Condition v1.0\n\nThe Software is provided to you by the Licensor under the License, as defined below, subject to the following condition.\n\nWithout limiting other conditions in the License, the grant of rights under the License will not include, and the License does not grant to you, the right to Sell the Software.\n\nFor purposes of the foregoing, 'Sell' means practicing any or all of the rights granted to you under the License to provide to third parties, for a fee or other consideration (including without limitation fees for hosting or consulting/support services related to the Software), a product or service whose value derives, entirely or substantially, from the functionality of the Software.\n\nAny license notice or attribution required by the License must also include this Commons Clause License Condition notice.\n\nSoftware: Marginly\nLicense: Apache 2.0\nLicensor: Karun Japhet\n\n---\n```\n\nThen followed by standard Apache 2.0 license text.\n\n## Files to Create\n- LICENSE\n\n## Depends On\n- Phase 1 complete\n- Phase 2 complete","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:24:16.282693+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:58:09.32922+05:30","closed_at":"2026-01-17T22:58:09.32922+05:30","close_reason":"Closed"}
{"id":"marginly-64r","title":"Validate manifest against brp schema in CI","description":"## Context\nbrp owns the manifest contract. ie-book should validate before publishing.\n\n## Implementation\n1. In release workflow, after building manifest:\n   - Fetch schema from https://review.karun.me/schemas/manifest.v2.schema.json\n   - Validate manifest.json against it\n   - Fail build if invalid\n\n2. Use ajv-cli or similar:\n   ```bash\n   curl -o manifest.schema.json https://review.karun.me/schemas/manifest.v2.schema.json\n   npx ajv-cli validate -s manifest.schema.json -d output/html/manifest.json\n   ```\n\n## Dependencies\n- Requires brp to expose schema first","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:31:48.588821+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:32:01.993735+05:30","closed_at":"2026-01-17T15:32:01.993735+05:30","close_reason":"Created in wrong repo - should be in ie-book"}
{"id":"marginly-68v","title":"Update package.json name to marginly","description":"Change name field in package.json.\n\n## Acceptance Criteria\n- [ ] Update package.json 'name' field from 'book-review-platform' to 'marginly'\n- [ ] Run npm install to regenerate package-lock.json\n- [ ] Verify no other references to old name in package files\n\n## Files to Modify\n- package.json (name field)\n- package-lock.json (auto-regenerated)","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:43.929939+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:52:15.731843+05:30","closed_at":"2026-01-17T22:52:15.731843+05:30","close_reason":"Closed"}
{"id":"marginly-6pe","title":"Initialize Next.js project structure","description":"Set up Next.js 14 with TypeScript, Tailwind, App Router. Create folder structure for components, lib, and app routes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T09:44:46.266081+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T09:49:29.957308+05:30","closed_at":"2026-01-17T09:49:29.957308+05:30","close_reason":"Initial Next.js 14 project with TypeScript, Tailwind, App Router scaffolded"}
{"id":"marginly-6xc","title":"Update beads issue prefix to marginly","description":"Change the beads issue prefix from 'book-review-platform' to 'marginly'.\n\n## Acceptance Criteria\n- [ ] Run: bd config set issue_prefix marginly\n- [ ] Verify new issues get 'marginly-xxx' prefix\n- [ ] Existing issues keep their 'book-review-platform-xxx' IDs (expected)\n\n## Notes\n- This only affects NEW issues created after the change\n- Existing issues retain their original IDs for consistency","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:27:09.95175+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:00:51.08856+05:30","closed_at":"2026-01-17T23:00:51.08856+05:30","close_reason":"Closed"}
{"id":"marginly-70r","title":"Create comprehensive README.md","description":"Document what Marginly is, features, self-hosting setup instructions, and screenshots.\n\n## Acceptance Criteria\n- [ ] Clear project description (what Marginly does)\n- [ ] Feature list with brief explanations\n- [ ] Self-hosting setup guide (Supabase, Vercel/other)\n- [ ] Environment variable documentation\n- [ ] Screenshots of key UI (optional but nice)\n- [ ] Quick start guide for local development\n\n## Sections to Include\n1. Project overview / tagline\n2. Features (bullet points)\n3. Tech stack\n4. Quick start (local dev)\n5. Self-hosting guide\n6. Environment variables\n7. Development commands\n8. Project structure (brief)\n9. License (reference LICENSE file)\n\n## Files to Modify\n- README.md\n\n## Notes\n- Current README is mostly good, enhance rather than rewrite\n- Add screenshots if available\n- Make sure self-hosting instructions are complete","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:59.09059+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:58:57.829626+05:30","closed_at":"2026-01-17T22:58:57.829626+05:30","close_reason":"Closed"}
{"id":"marginly-72a","title":"Selection expands to article start during drag","description":"When dragging to select text, the selection jumps to start from beginning of article. handleTextSelection is firing continuously during drag, re-capturing the selection. Should only fire on mouseup.","status":"closed","priority":0,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T20:36:33.60981+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T20:39:34.77698+05:30","closed_at":"2026-01-17T20:39:34.77698+05:30","close_reason":"Closed"}
{"id":"marginly-7a3","title":"Create fetch-books.mjs to pull from GitHub releases","description":"## Context\nPlatform pulls book content from configured sources instead of books pushing to platform.\n\n## New script: scripts/fetch-books.mjs\n\n```javascript\n// For each book in books.config.json:\n// 1. Fetch latest release from GitHub API\n// 2. Download release artifact (tar.gz)\n// 3. Extract to public/books/{slug}/\n// 4. Verify manifest.json exists\n```\n\n## GitHub API for releases\n```\nGET /repos/{owner}/{repo}/releases/tags/{tag}\n```\n\nReturns asset download URLs. Need GITHUB_TOKEN for private repos.\n\n## Environment variables\n- GITHUB_TOKEN: Required for private repos (repo scope)\n\n## Error handling\n- Skip book if release not found (warn, don't fail)\n- Skip book if artifact missing\n- Validate manifest.json after extraction\n\n## CLI usage\n```bash\n# Fetch all books\nnode scripts/fetch-books.mjs\n\n# Fetch specific book\nnode scripts/fetch-books.mjs --book=intelligent-engineering\n```","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:14:05.067808+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:24:09.446783+05:30","closed_at":"2026-01-17T15:24:09.446783+05:30","close_reason":"Closed","dependencies":[{"issue_id":"marginly-7a3","depends_on_id":"marginly-lfk","type":"blocks","created_at":"2026-01-17T15:14:19.04513+05:30","created_by":"Karun Japhet"}]}
{"id":"marginly-8ko","title":"Comment selection captures wrong text","description":"handleTextSelection uses window.getSelection() which captures any selected text on page, not just within chapter content div. Need to verify selection is within the target element.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T18:18:56.534755+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T18:20:13.178813+05:30","closed_at":"2026-01-17T18:20:13.178813+05:30","close_reason":"Closed"}
{"id":"marginly-8xc","title":"EPIC: Phase 1 - Clean personal data from repo","description":"Remove all personal/specific data to prepare for public FOSS release.\n\n## Subtasks (in order)\n1. [b6v] Add public/books/ and books.config.json to .gitignore\n2. [4an] Create books.config.example.json\n3. [dzx] Create .env.example (rename from .env.local.example)\n4. [b1o] Update fetch-books.mjs to read config from env var\n5. [abs] Purge public/books/ and books.config.json from git history (LAST - destructive)\n\n## Notes\n- All subtasks must complete before history purge\n- History purge requires force-push","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:08.761452+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:51:45.278803+05:30","closed_at":"2026-01-17T22:51:45.278803+05:30","close_reason":"Closed"}
{"id":"marginly-9sa","title":"Add unit test pipeline with Vitest","description":"Set up Vitest for unit testing components and utility functions. Add CI integration.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T11:05:31.077331+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:46:37.890256+05:30","closed_at":"2026-01-17T14:46:37.890256+05:30","close_reason":"Closed"}
{"id":"marginly-9xm","title":"Rename GitHub repository to marginly","description":"Rename javatarz/book-review-platform to javatarz/marginly on GitHub.\n\n## Acceptance Criteria\n- [ ] Rename repository in GitHub Settings\n- [ ] Update local git remote URL\n- [ ] Verify push/pull works with new URL\n\n## Steps (manual)\n1. Go to GitHub repo Settings \u003e General\n2. Change repository name to 'marginly'\n3. Locally run: git remote set-url origin git@github.com:javatarz/marginly.git\n4. Verify: git remote -v\n\n## Prerequisites\n- All code changes (package.json, branding) must be pushed first\n- Do this LAST in Phase 2\n\n## Notes\n- GitHub will redirect old URLs for a period\n- All clone URLs will change","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:43.851068+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:54:42.21964+05:30","closed_at":"2026-01-17T22:54:42.21964+05:30","close_reason":"Closed"}
{"id":"marginly-a0w","title":"Implement reading progress tracking","description":"Track scroll position and time spent per chapter. Record reading sessions. Mark chapters as completed when scroll reaches 90%.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T09:44:50.102991+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:21:34.610374+05:30","closed_at":"2026-01-17T14:21:34.610374+05:30","close_reason":"Added time tracking with idle detection, reading sessions, scroll restoration, and time_spent_seconds tracking"}
{"id":"marginly-a2x","title":"Fix login flow - RLS blocks email check for unauthenticated users","description":"## Problem\nThe login page queries `book_access` to verify the email before sending a magic link. But the RLS policy requires authentication:\n\n```sql\nusing (user_id = auth.uid() or user_email = auth.email())\n```\n\nSince `auth.email()` is null for unauthenticated users, the query returns nothing and users see 'No account found' even when they have access.\n\n## Fix\nCreate a `security definer` function that anonymous users can call:\n\n```sql\ncreate or replace function public.check_email_has_access(check_email text)\nreturns boolean\nlanguage sql\nsecurity definer\nas $$\n  select exists (\n    select 1 from public.book_access\n    where user_email = lower(check_email)\n  );\n$$;\n\ngrant execute on function public.check_email_has_access(text) to anon;\n```\n\nThen update `src/app/login/page.tsx` to use `supabase.rpc('check_email_has_access', { check_email: email })` instead of querying the table directly.\n\n## Files to change\n- `supabase/migrations/\u003ctimestamp\u003e_add_check_access_function.sql` (new)\n- `src/app/login/page.tsx`","status":"closed","priority":0,"issue_type":"bug","owner":"karun@japhet.in","created_at":"2026-01-17T10:46:02.694992+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T11:05:48.640159+05:30","closed_at":"2026-01-17T11:05:48.640159+05:30","close_reason":"Added security definer function and updated login page to use RPC"}
{"id":"marginly-abs","title":"Purge public/books/ from git history","description":"Use git filter-repo to remove all book content from history before going public.\n\n## Acceptance Criteria\n- [ ] Remove public/books/ from all git history\n- [ ] Remove books.config.json from all git history\n- [ ] Verify clean history with no personal book content\n- [ ] Force push to remote (requires explicit confirmation)\n\n## Prerequisites\n- [ ] All other Phase 1 tasks must be complete first\n- [ ] git-filter-repo must be installed (brew install git-filter-repo)\n\n## Commands (reference)\n```bash\ngit filter-repo --path public/books/ --path books.config.json --invert-paths\ngit push --force-with-lease\n```\n\n## WARNINGS\n- This rewrites git history and requires force push\n- All collaborators will need to re-clone\n- This is irreversible - backup first if needed\n\n## Depends On\n- b6v (gitignore)\n- 4an (example config)\n- dzx (env.example)\n- b1o (fetch-books env var support)","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:27.087332+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:51:45.220902+05:30","closed_at":"2026-01-17T22:51:45.220902+05:30","close_reason":"Closed"}
{"id":"marginly-akm","title":"EPIC: Phase 3 - FOSS documentation","description":"Create documentation for open source release including README, LICENSE, and contribution guidelines","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:51.253735+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:26:58.222231+05:30","closed_at":"2026-01-17T22:26:58.222231+05:30","close_reason":"Superseded by 570 (Phase 3 - Add license and go public)"}
{"id":"marginly-aze","title":"Sync manifest.json to chapters table on deploy","description":"## Context\nWhen book content is pushed to `public/books/{slug}/manifest.json`, sync chapter metadata to Supabase.\n\n## Requirements\n1. Trigger on changes to `public/books/**/manifest.json`\n2. Read manifest.json for each book\n3. Upsert to `chapters` table: book_id, slug, number, title, status\n4. Depends on book existing (run after book discovery)\n\n## Implementation\nGitHub Action in book-review-platform:\n```yaml\non:\n  push:\n    paths:\n      - 'public/books/**/manifest.json'\n```\n\nUse Supabase REST API with service_role key (secrets stay in this repo).","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T12:59:15.775419+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T13:21:26.733896+05:30","closed_at":"2026-01-17T13:21:26.733896+05:30","close_reason":"Sync manifest.json to chapters table via Vercel pipeline"}
{"id":"marginly-b1o","title":"Update fetch-books.mjs to read config from env var","description":"Support BOOKS_CONFIG env var as JSON string, fallback to file. Allows deployment without committing config.\n\n## Acceptance Criteria\n- [ ] Check for BOOKS_CONFIG env var first (JSON string)\n- [ ] Fall back to books.config.json file if env var not set\n- [ ] Parse JSON from env var and validate structure\n- [ ] Log which config source is being used\n- [ ] Update User-Agent from 'book-review-platform' to 'marginly'\n\n## Implementation\n```javascript\nasync function loadConfig() {\n  // Check env var first\n  if (process.env.BOOKS_CONFIG) {\n    console.log('Loading config from BOOKS_CONFIG env var');\n    return JSON.parse(process.env.BOOKS_CONFIG);\n  }\n  // Fall back to file\n  console.log('Loading config from books.config.json');\n  const content = await readFile(CONFIG_PATH, 'utf-8');\n  return JSON.parse(content);\n}\n```\n\n## Files to Modify\n- scripts/fetch-books.mjs (loadConfig function, User-Agent strings)\n\n## Notes\n- User-Agent update is included here since we're already modifying this file","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:27.163328+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:49:50.433312+05:30","closed_at":"2026-01-17T22:49:50.433312+05:30","close_reason":"Closed"}
{"id":"marginly-b51","title":"Comment selection disrupted by time tracking re-renders","description":"Text selection was being disrupted during drag because setTimeSpent() ran every 1s causing React re-renders that re-applied dangerouslySetInnerHTML. Fixed by changing timeSpent from state to ref.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T21:48:49.290613+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T21:48:54.943998+05:30","closed_at":"2026-01-17T21:48:54.943998+05:30","close_reason":"Closed"}
{"id":"marginly-b6v","title":"Add public/books/ and books.config.json to .gitignore","description":"Prevent book content and personal config from being tracked.\n\n## Acceptance Criteria\n- [ ] Add `public/books/` to .gitignore\n- [ ] Add `books.config.json` to .gitignore\n- [ ] Verify existing tracked files show as 'deleted' in git status after gitignore update\n\n## Files to Modify\n- .gitignore\n\n## Notes\n- Must be done BEFORE history purge\n- After gitignore update, files will still be in git until explicitly removed","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:26.858297+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:34:52.272232+05:30","closed_at":"2026-01-17T22:34:52.272232+05:30","close_reason":"Closed"}
{"id":"marginly-bun","title":"Fix email and signout button alignment in header","description":"In the header, the email address and 'Sign out' button are not vertically aligned.\n\nCause: The form element wrapping the signout button may cause baseline misalignment.\n\nLocation: src/app/page.tsx lines 40-49\n\nFix: Ensure consistent vertical alignment, possibly by styling the form/button to match text baseline.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:27:56.186233+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:31:05.019224+05:30","closed_at":"2026-01-17T15:31:05.019224+05:30","close_reason":"Closed"}
{"id":"marginly-d1u","title":"Make CLAUDE.md generic","description":"Remove personal URL examples, make instructions generic for any deployer.\n\n## Acceptance Criteria\n- [ ] Replace analytics.karun.me with generic placeholder\n- [ ] Replace review.karun.me with generic placeholder\n- [ ] Remove any personal-specific instructions\n- [ ] Ensure self-hosters can follow instructions easily\n\n## Files to Modify\n- CLAUDE.md\n\n## Search for Personal References\n```bash\ngrep -n 'karun' CLAUDE.md\n```\n\n## Notes\n- Keep the structure and technical content\n- Just replace personal URLs/names with generic placeholders","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:27.240336+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:57:38.077857+05:30","closed_at":"2026-01-17T22:57:38.077857+05:30","close_reason":"Closed"}
{"id":"marginly-dwm","title":"Add GitHub topics for discoverability","description":"Add topics to improve repo discoverability.\n\n## Topics to Add\n- nextjs\n- supabase\n- typescript\n- tailwindcss\n- self-hosted\n- book-review\n- beta-readers\n- feedback\n- annotations\n- react\n\n## Command\n```bash\ngh repo edit javatarz/marginly --add-topic nextjs,supabase,typescript,tailwindcss,self-hosted,book-review,beta-readers,feedback,annotations,react\n```\n\n## Acceptance Criteria\n- [ ] All 10 topics added\n- [ ] Verify topics appear on repo page","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T23:51:14.955193+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:52:55.546323+05:30","closed_at":"2026-01-17T23:52:55.546323+05:30","close_reason":"Closed"}
{"id":"marginly-dzx","title":"Create .env.example","description":"Document all required environment variables for self-hosting.\n\n## Acceptance Criteria\n- [ ] Rename .env.local.example to .env.example\n- [ ] Remove personal analytics URL (analytics.karun.me)\n- [ ] Include all environment variables grouped by purpose\n\n## Required Environment Variables\n### Core (required for local dev)\n- NEXT_PUBLIC_SUPABASE_URL\n- NEXT_PUBLIC_SUPABASE_ANON_KEY\n- NEXT_PUBLIC_APP_URL\n\n### Book Fetching (optional - for fetch-books script)\n- GITHUB_TOKEN (for private repos)\n- BOOKS_CONFIG (JSON string, alternative to books.config.json file)\n\n### CI/CD (required for Vercel deployment)\n- SUPABASE_ACCESS_TOKEN\n- SUPABASE_PROJECT_REF\n- SUPABASE_SERVICE_ROLE_KEY\n\n### Analytics (optional)\n- NEXT_PUBLIC_UMAMI_WEBSITE_ID\n- NEXT_PUBLIC_UMAMI_URL\n\n## Files to Modify\n- Delete: .env.local.example\n- Create: .env.example","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:27.012127+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:49:19.772684+05:30","closed_at":"2026-01-17T22:49:19.772684+05:30","close_reason":"Closed"}
{"id":"marginly-ftp","title":"Build admin dashboard","description":"Dashboard for author to see all readers, their progress, and comments. Invite new readers. View comments with filters by chapter/reader. Basic analytics.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T09:44:51.993503+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:30:09.445129+05:30","closed_at":"2026-01-17T14:30:09.445129+05:30","close_reason":"Added admin dashboard with readers management, comments review with filters, and chapter-level analytics"}
{"id":"marginly-i22","title":"Renamed chapters create duplicates instead of updating","description":"When a chapter slug changes (rename), sync-books.mjs creates a new chapter record, leaving the old one orphaned with its reading stats and comments.\n\n**Symptom:** Two chapters with same number appear in TOC (e.g., two 'Chapter 3' entries).\n\n**Solution:** Admin-assisted migration UI\n\n1. **Detection:** On sync or in admin panel, detect books with duplicate chapter numbers\n2. **Admin UI:** Show warning: 'Chapter 3 has conflicting entries: old-slug vs new-slug'\n3. **Migration action:** Button to migrate data from old slug to new slug:\n   - Move comments to new slug\n   - Move reading_progress to new slug  \n   - Move reading_sessions to new slug\n   - Delete old chapter record\n\n**Why not auto-migrate:**\n- Renames are rare\n- Human should verify it's actually a rename vs. a new chapter\n- Preserves data integrity with oversight\n\n**Acceptance:**\n- [ ] Admin panel shows warning when duplicate chapter numbers exist\n- [ ] Migration UI allows selecting source (old) and target (new) slug\n- [ ] One-click migration moves all related data\n- [ ] Old chapter deleted after successful migration","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-18T16:07:08.173074+05:30","created_by":"Karun Japhet","updated_at":"2026-01-18T17:10:53.926031+05:30","closed_at":"2026-01-18T17:10:53.926031+05:30","close_reason":"Closed"}
{"id":"marginly-inb","title":"EPIC: Phase 2 - Rename to Marginly","description":"Rename all references from book-review-platform to Marginly.\n\n## Subtasks (in order)\n1. [68v] Update package.json name to marginly\n2. [qvx] Update page titles, branding, and CLAUDE.md to Marginly\n3. [6xc] Update beads issue prefix to marginly\n4. [9xm] Rename GitHub repository to marginly (manual - do after code pushed)\n5. [zg3] Rename Vercel project to marginly (manual - do after GitHub rename)\n\n## Notes\n- Code changes first (68v, qvx, 6xc), then push\n- Then manual renames (9xm GitHub, zg3 Vercel)\n- After GitHub rename, update git remote URL\n- README license change happens in Phase 3 (separate card)","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:35.421278+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:52:53.078404+05:30","closed_at":"2026-01-17T22:52:53.078404+05:30","close_reason":"Closed"}
{"id":"marginly-ke4","title":"Add README badges","description":"Add badges to README for quick visual info.\n\n## Badges to Add\n1. License badge (Apache 2.0)\n2. Deploy to Vercel button\n3. Tech stack badges (Next.js, Supabase, TypeScript)\n\n## Badge Markdown\n```markdown\n[![License](https://img.shields.io/badge/License-Apache_2.0_with_Commons_Clause-blue.svg)](LICENSE)\n[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/javatarz/marginly)\n\n![Next.js](https://img.shields.io/badge/Next.js-14-black?logo=next.js)\n![Supabase](https://img.shields.io/badge/Supabase-PostgreSQL-3FCF8E?logo=supabase)\n![TypeScript](https://img.shields.io/badge/TypeScript-5-3178C6?logo=typescript)\n```\n\n## Placement\nAdd at top of README, right after the H1 title\n\n## Acceptance Criteria\n- [ ] License badge links to LICENSE file\n- [ ] Deploy button works (test the link)\n- [ ] Tech badges display correctly","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T23:51:15.711487+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:53:55.391099+05:30","closed_at":"2026-01-17T23:53:55.391099+05:30","close_reason":"Closed"}
{"id":"marginly-kwy","title":"DECISION: Choose open source license","description":"Options:\n\n**MIT License**\n- Pros: Maximum adoption, simple, widely understood\n- Cons: No copyleft, no patent protection\n\n**Apache 2.0**\n- Pros: Patent protection, corporate-friendly, still permissive\n- Cons: Slightly more complex text\n\n**AGPL-3.0**\n- Pros: Copyleft for SaaS - if someone hosts Marginly, they must share changes\n- Cons: Scares away corporate contributors\n\nRecommendation: MIT for maximum adoption, or Apache 2.0 if patent protection matters.","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:09:36.315635+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:26:57.535107+05:30","closed_at":"2026-01-17T22:26:57.535107+05:30","close_reason":"Decision made: Apache 2.0 + Commons Clause"}
{"id":"marginly-l5s","title":"Create CONTRIBUTING.md","description":"Create comprehensive contributor guidelines.\n\n## Acceptance Criteria\nInclude all of the following sections:\n\n### Basic Sections\n- [ ] How to report bugs\n- [ ] How to suggest features\n- [ ] PR process (fork, branch, test, PR)\n- [ ] Code of conduct reference\n\n### Comprehensive Sections\n- [ ] Code style guide (ESLint/Prettier configuration)\n- [ ] Architecture overview\n- [ ] Testing requirements (unit tests, E2E tests)\n- [ ] Commit message format (reference CLAUDE.md format)\n- [ ] Review process and expectations\n\n## Files to Create\n- CONTRIBUTING.md\n\n## Notes\n- Reference existing CLAUDE.md for commit message format\n- Keep architecture section high-level, link to detailed docs if needed","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:59.243327+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:59:27.279788+05:30","closed_at":"2026-01-17T22:59:27.279788+05:30","close_reason":"Closed"}
{"id":"marginly-lfk","title":"Add books.config.json for book sources","description":"## Context\nPlatform should discover books from a config file, not hardcode them.\n\n## New file: books.config.json\n```json\n{\n  \"books\": [\n    {\n      \"slug\": \"intelligent-engineering\",\n      \"source\": {\n        \"type\": \"github-release\",\n        \"repo\": \"javatarz/intelligent-engineering-book\",\n        \"release\": \"latest\"\n      }\n    }\n  ]\n}\n```\n\n## Future extensibility\nSource types could include:\n- github-release (current)\n- github-pages\n- url (direct HTTP fetch)\n\n## Usage\n- fetch-books.mjs reads this config\n- Platform deploy workflow iterates over configured books\n- Easy to add new books: add entry to config","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:14:04.222174+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:23:00.621682+05:30","closed_at":"2026-01-17T15:23:00.621682+05:30","close_reason":"Closed"}
{"id":"marginly-myi","title":"Implement magic link auth flow","description":"Implement invite-only auth: login page checks book_access before sending magic link, auth callback, session middleware, signout. No self-registration allowed.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T09:44:48.200971+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T09:49:32.280951+05:30","closed_at":"2026-01-17T09:49:32.280951+05:30","close_reason":"Magic link auth with invite-only check, middleware, and session handling implemented"}
{"id":"marginly-n14","title":"Remove versions table, use manifest lastUpdated","description":"## Context\nTrunk-based releases mean we don't need semantic versioning. Simplify by removing versions table and using manifest's lastUpdated field directly.\n\n## Changes\n\n### Database\n- Remove `versions` table\n- Add `last_synced_at` column to `books` table (when content was last fetched)\n- Keep `reading_progress.last_read_at` for \"new since you visited\" comparison\n\n### Logic for \"new content\" indicator\n```\nhasNewContent = book.last_synced_at \u003e user.reading_progress.last_read_at\n```\n\n### UI\n- Remove any version display\n- Show \"Updated\" badge if content changed since user's last visit\n- Show last updated date on book page (from manifest)\n\n### Migration\n- Create migration to drop versions table\n- Add last_synced_at to books table\n- Update sync-books.mjs to set last_synced_at when syncing\n\n## Files to update\n- supabase/migrations/ (new migration)\n- scripts/sync-books.mjs\n- Book page component (show last updated)\n- Chapter list (show \"new\" indicators)","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:16:13.847033+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:33:14.01918+05:30","closed_at":"2026-01-17T15:33:14.01918+05:30","close_reason":"Closed"}
{"id":"marginly-nzq","title":"DECISION: CONTRIBUTING.md scope and content","description":"Options:\n\n**Minimal (recommended for start)**\n- How to report bugs\n- How to suggest features  \n- PR process (fork, branch, test, PR)\n- Code of conduct reference\n\n**Comprehensive**\n- All of minimal, plus:\n- Code style guide (Prettier/ESLint config explanation)\n- Architecture overview\n- Testing requirements\n- Commit message format\n- Review process details\n\n**With templates**\n- GitHub issue templates (bug, feature)\n- PR template with checklist\n\nRecommendation: Start minimal, add more as community grows. Templates are low effort and helpful.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:09:45.743853+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:28:20.82821+05:30","closed_at":"2026-01-17T22:28:20.82821+05:30","close_reason":"Decision made: Comprehensive CONTRIBUTING.md"}
{"id":"marginly-o6n","title":"Support manifest v2 with supplementary resources","description":"## Context\nBooks declare their content through manifest.json. We need to support a v2 format that includes supplementary resources like bibliography and appendices.\n\n## Contract (manifest.json v2)\n\n```json\n{\n  \"version\": 2,\n  \"chapters\": [\n    {\"slug\": \"production-doesnt-run-on-vibes\", \"title\": \"...\", \"number\": 1, \"status\": \"ready\"}\n  ],\n  \"supplementary\": [\n    {\"slug\": \"bibliography\", \"title\": \"References\", \"type\": \"bibliography\"}\n  ]\n}\n```\n\n## Changes Required\n\n### 1. Update manifest reading logic\n\nIn scripts/sync-books.mjs (or wherever manifest is read):\n- Detect manifest version (v1 = array, v2 = object with version field)\n- Handle both formats for backwards compatibility\n- Extract chapters from `manifest.chapters` for v2\n\n### 2. Update [book]/[chapter] route (or rename to [book]/[content])\n\nCurrent: Only looks up chapters in database\nNew: Also check supplementary resources from manifest\n\nLogic:\n1. Fetch manifest for the book\n2. Check if slug exists in `chapters` array → serve as chapter\n3. Check if slug exists in `supplementary` array → serve as supplementary content\n4. Neither → 404\n\n### 3. Serve supplementary content\n\n- Same pattern as chapters: fetch HTML from `/books/{bookSlug}/{slug}.html`\n- Apply authentication (same as chapters)\n- Simpler UI than chapters (no chapter number, no prev/next navigation)\n- Include back link to book page\n\n### 4. Update book page to show supplementary links\n\nOn the book's table of contents page, show supplementary resources:\n- \"References\" link if bibliography exists\n- \"Appendix A: ...\" if appendices exist","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T14:52:31.976555+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:56:41.705658+05:30","closed_at":"2026-01-17T14:56:41.705658+05:30","close_reason":"Closed"}
{"id":"marginly-pm4","title":"Book content discovery and sync from GitHub releases","description":"## Overview\nDecouple book-review-platform from individual book repos. Platform discovers and pulls book content from GitHub releases instead of books pushing directly.\n\n## Goals\n- Clean separation: books publish releases, platform pulls them\n- Easy to add new books via config\n- Manifest-based contract (v2 format with chapters, supplementary, metadata)\n- Track content updates without semantic versioning\n\n## Tasks\n- marginly-o6n: Support manifest v2 with supplementary\n- marginly-lfk: Add books.config.json\n- marginly-7a3: Create fetch-books.mjs\n- marginly-1d5: Update deploy workflow\n- marginly-n14: Remove versions table, use lastUpdated","status":"closed","priority":1,"issue_type":"epic","owner":"karun@japhet.in","created_at":"2026-01-17T15:17:29.393736+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:38:37.782774+05:30","closed_at":"2026-01-17T15:38:37.782774+05:30","close_reason":"Closed","dependencies":[{"issue_id":"marginly-pm4","depends_on_id":"marginly-o6n","type":"blocks","created_at":"2026-01-17T15:17:36.026849+05:30","created_by":"Karun Japhet"},{"issue_id":"marginly-pm4","depends_on_id":"marginly-lfk","type":"blocks","created_at":"2026-01-17T15:17:36.107047+05:30","created_by":"Karun Japhet"},{"issue_id":"marginly-pm4","depends_on_id":"marginly-7a3","type":"blocks","created_at":"2026-01-17T15:17:36.190875+05:30","created_by":"Karun Japhet"},{"issue_id":"marginly-pm4","depends_on_id":"marginly-1d5","type":"blocks","created_at":"2026-01-17T15:17:36.272406+05:30","created_by":"Karun Japhet"},{"issue_id":"marginly-pm4","depends_on_id":"marginly-n14","type":"blocks","created_at":"2026-01-17T15:17:36.348555+05:30","created_by":"Karun Japhet"},{"issue_id":"marginly-pm4","depends_on_id":"marginly-aze","type":"blocks","created_at":"2026-01-17T15:18:13.629998+05:30","created_by":"Karun Japhet"},{"issue_id":"marginly-pm4","depends_on_id":"marginly-v4g","type":"blocks","created_at":"2026-01-17T15:18:13.68513+05:30","created_by":"Karun Japhet"},{"issue_id":"marginly-pm4","depends_on_id":"marginly-2wg","type":"blocks","created_at":"2026-01-17T15:32:10.409291+05:30","created_by":"Karun Japhet"}]}
{"id":"marginly-pw7","title":"Add user profile with display name","description":"Allow users to click email in header to edit profile and set display name. Show display name in header and comments when set, fallback to email.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T17:35:44.149104+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T17:39:27.90688+05:30","closed_at":"2026-01-17T17:39:27.90688+05:30","close_reason":"Closed"}
{"id":"marginly-qij","title":"Create Supabase schema and RLS policies","description":"Create database tables: books, chapters, book_access, comments, reading_progress, reading_sessions. Set up Row Level Security policies for invite-only access.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T09:44:47.221301+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T09:49:31.16657+05:30","closed_at":"2026-01-17T09:49:31.16657+05:30","close_reason":"Schema created in supabase/schema.sql with all tables and RLS policies"}
{"id":"marginly-qvx","title":"Update page titles and branding to Marginly","description":"Update HTML titles, headers, and any UI text that says 'Book Review Platform'.\n\n## Acceptance Criteria\n- [ ] Update src/app/layout.tsx title to 'Marginly'\n- [ ] Update src/app/layout.tsx description\n- [ ] Update CLAUDE.md project references\n- [ ] Update README.md header from 'Book Review Platform' to 'Marginly'\n- [ ] Verify no remaining references to 'Book Review Platform' in codebase\n\n## Files to Modify\n- src/app/layout.tsx (title, description)\n- CLAUDE.md (project name references)\n- README.md (header only - NOT the license section)\n\n## Grep Check After\n```bash\ngrep -r 'Book Review Platform' --include='*.{ts,tsx,js,md,json}'\ngrep -r 'book-review-platform' --include='*.{ts,tsx,js,md,json}'\n```\n\n## Notes\n- README license change ('Private') stays until Phase 3\n- CLAUDE.md should use 'Marginly' for project name","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:44.006877+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:52:53.023384+05:30","closed_at":"2026-01-17T22:52:53.023384+05:30","close_reason":"Closed"}
{"id":"marginly-rut","title":"Build inline commenting system","description":"Text selection to create comments anchored to specific paragraphs. Comment sidebar showing all comments for a chapter. Reply threads and resolve functionality.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T09:44:51.041615+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:26:26.652526+05:30","closed_at":"2026-01-17T14:26:26.652526+05:30","close_reason":"Added reply threads, resolve functionality, show/hide resolved filter"}
{"id":"marginly-srf","title":"Add E2E test pipeline with Playwright","description":"Add E2E tests for critical paths: login flow, book access, chapter reading. Set up Playwright and CI integration.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T11:05:30.577372+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:46:37.966266+05:30","closed_at":"2026-01-17T14:46:37.966266+05:30","close_reason":"Closed"}
{"id":"marginly-v4g","title":"Auto-discover books from public/books/ on deploy","description":"## Context\nBooks shouldn't need to be created manually in Supabase. The platform should discover them from the filesystem.\n\n## Requirements\n1. On deploy, scan `public/books/*/` directories\n2. Each directory with a `manifest.json` is a book\n3. Upsert to `books` table: slug (from directory name), title/description (from manifest or defaults)\n4. Run before chapter sync\n\n## Implementation options\n- GitHub Action triggered on `public/books/**/manifest.json` changes\n- Vercel build script\n- Script in package.json postbuild\n\n## Manifest additions needed\nAdd to manifest.json in ie-book:\n```json\n{\n  \"book\": {\n    \"title\": \"intelligent Engineering\",\n    \"description\": \"...\",\n    \"version\": \"0.02\"\n  },\n  \"chapters\": [...]\n}\n```","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T12:59:07.03139+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T13:21:26.678938+05:30","closed_at":"2026-01-17T13:21:26.678938+05:30","close_reason":"Auto-discover books from public/books/ via sync script"}
{"id":"marginly-vw4","title":"Book card layout broken - date badge awkward position","description":"On homepage, the date badge next to title looked broken/awkward. Fixed by moving Updated badge to top-right corner and date to footer row with other metadata.","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T21:49:02.714689+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T21:50:06.296349+05:30","closed_at":"2026-01-17T21:50:06.296349+05:30","close_reason":"Closed"}
{"id":"marginly-vyk","title":"Consolidate CI/CD into single pipeline","description":"Merge migration and deploy into one coordinated pipeline. Add --include-all flag. Vercel should only deploy after migrations succeed.","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T11:16:14.538868+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T12:10:58.636324+05:30","closed_at":"2026-01-17T12:10:58.636324+05:30","close_reason":"Unified CI pipeline with lint, build, migrate stages"}
{"id":"marginly-wpi","title":"Build admin dashboard","description":"## Features needed\n- View all readers and their access levels\n- See reading progress per reader per chapter\n- View and manage comments\n- Invite new readers (add to book_access)\n- Basic analytics (who read what, when)\n\n## Route\n`/admin` or `/[book]/admin`","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T10:46:17.570792+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T10:47:07.350058+05:30","closed_at":"2026-01-17T10:47:07.350058+05:30","close_reason":"Duplicate of book-review-platform-ftp"}
{"id":"marginly-wuc","title":"Build book review platform MVP","description":"Build the core book review platform with auth, chapter rendering, inline comments, and reading progress tracking. Tech stack: Next.js 14, Supabase, Vercel.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-17T09:44:28.876099+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T14:41:04.610491+05:30","closed_at":"2026-01-17T14:41:04.610491+05:30","close_reason":"Closed"}
{"id":"marginly-yje","title":"Add admin link to header for global admins","description":"Currently no UI path to /admin pages. Add an 'Admin' link in the header that only shows for users in the global_admins table.\n\nLocation: src/app/page.tsx (and possibly other pages with headers)\n\nRequirements:\n- Check if user is global admin\n- Show 'Admin' link next to email/signout\n- Link to /admin","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T15:27:48.487601+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T15:31:04.946027+05:30","closed_at":"2026-01-17T15:31:04.946027+05:30","close_reason":"Closed"}
{"id":"marginly-yt7","title":"Update README.md license section for public release","description":"Change README from 'Private' to reference the Apache 2.0 + Commons Clause license.\n\n## Acceptance Criteria\n- [ ] Remove 'Private - for personal use only' text\n- [ ] Add proper license section referencing LICENSE file\n- [ ] Explain that commercial use requires permission\n\n## New License Section\n```markdown\n## License\n\nLicensed under Apache 2.0 with Commons Clause. See [LICENSE](LICENSE) for details.\n\nThis means you can freely use, modify, and distribute this software for non-commercial purposes. Commercial use requires explicit permission from the author.\n```\n\n## Files to Modify\n- README.md (License section at bottom)\n\n## Depends On\n- LICENSE file must be created first","status":"closed","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:24:16.620542+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T22:58:23.747296+05:30","closed_at":"2026-01-17T22:58:23.747296+05:30","close_reason":"Closed"}
{"id":"marginly-zea","title":"Show comment author in reader view","description":"Comments currently show timestamp but not who wrote them. Add author display (display_name or email) to comments in the chapter reader.","status":"in_progress","priority":2,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-20T22:19:16.583232+05:30","created_by":"Karun Japhet","updated_at":"2026-01-20T22:19:22.280814+05:30"}
{"id":"marginly-zg3","title":"Rename Vercel project to marginly","description":"Update Vercel project name and configure marginly.karun.me domain.\n\n## Acceptance Criteria\n- [ ] Rename Vercel project from 'book-review-platform' to 'marginly'\n- [ ] Update custom domain if applicable (marginly.karun.me)\n- [ ] Verify deployment still works after rename\n\n## Steps (manual in Vercel dashboard)\n1. Go to Vercel project settings\n2. Change project name to 'marginly'\n3. Update domain configuration if needed\n4. Trigger a redeploy to verify\n\n## Notes\n- Do this after code changes are pushed\n- Existing deployments continue to work","status":"closed","priority":1,"issue_type":"task","owner":"karun@japhet.in","created_at":"2026-01-17T22:07:44.086376+05:30","created_by":"Karun Japhet","updated_at":"2026-01-17T23:17:17.284478+05:30","closed_at":"2026-01-17T23:17:17.284478+05:30","close_reason":"Closed"}
